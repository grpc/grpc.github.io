<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cjyabraham.github.io/grpccss/style.css">
    <title>
   &ndash; gRPC
</title>
  </head>
  <body>

    <div id="landing-content">
      <div class="row">
        <div class="topbannersub">
          <div class="logonav">
                <img src="https://cjyabraham.github.io/grpcimg/grpc-logo.png" style="width:10%">
            </div>
            <div class="topnav">
                <a href="https://cjyabraham.github.io/grpcabout/">About</a>
		<a href="https://cjyabraham.github.io/grpcdocs/">Docs</a>
		<a href="https://cjyabraham.github.io/grpcblog/">Blog</a> 
		<a href="https://cjyabraham.github.io/grpccommunity/">Community</a>
		<a href="https://packages.grpc.io/">Packages</a> 
		<a href="https://cjyabraham.github.io/grpcfaq/">FAQ</a>
            </div>
    
            <div class="headertext"></div>
  </div>
        </div>
        </div>

  <div class="section2" style="text-align:left;margin-bottom:5%">
    

<p class="lead">This guide gets you started with gRPC on the iOS platform in
Objective-C with a simple working example.</p>

<div id="toc"></div>

<h2 id="before-you-begin">Before you begin</h2>

<h3 id="system-requirement">System requirement</h3>

<p>The minimum deployment iOS version for gRPC is 7.0.</p>

<p>OS X El Capitan (version 10.11) or above is required to build and run this
Quickstart.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
<li><p><code>CocoaPods</code>: version 1.0 or higher</p>

<ul>
<li>Check status and version of CocoaPods on your system with command <code>pod
--version</code>.</li>
<li>If CocoaPods is not installed, follow the install instructions on CocoaPods
<a href="https://cocoapods.org">website</a>.</li>
</ul></li>

<li><p><code>Xcode</code>: version 7.2 or higher</p>

<ul>
<li>Check your Xcode version by running Xcode from Lauchpad, then select
&ldquo;Xcode-&gt;About Xcode&rdquo; in the menu.</li>
<li>Make sure the command line developer tools are installed:
<code>sh
[sudo] xcode-select --install
</code></li>
</ul></li>

<li><p><code>Homebrew</code></p>

<ul>
<li>Check status and version of Homebrew on your system with command <code>brew
--version</code>.</li>
<li>If Homebrew is not installed, install with:
<code>sh
/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></li>
</ul></li>

<li><p><code>autoconf</code>, <code>automake</code>, <code>libtool</code>, <code>pkg-config</code></p>

<ul>
<li>Install with Homebrew
<code>sh
brew install autoconf automake libtool pkg-config
</code></li>
</ul></li>
</ul>

<h2 id="download-the-example">Download the example</h2>

<p>You&rsquo;ll need a local copy of the sample app source code to work through this
Quickstart. Copy the source code from Github
<a href="https://github.com/grpc/grpc">repository</a>:</p>

<pre><code class="language-sh">$ git clone --recursive -b {{ site.data.config.grpc_release_tag }} https://github.com/grpc/grpc.git
</code></pre>

<h2 id="install-grpc-plugins-and-libraries">Install gRPC plugins and libraries</h2>

<pre><code class="language-sh">$ cd grpc
$ make
$ [sudo] make install
</code></pre>

<h2 id="install-protoc-compiler">Install protoc compiler</h2>

<pre><code class="language-sh">$ brew tap grpc/grpc
$ brew install protobuf
</code></pre>

<h2 id="run-the-server">Run the server</h2>

<p>For this sample app, we need a gRPC server running on the local machine. gRPC
Objective-C API supports creating gRPC clients but not gRPC servers. Therefore
instead we build and run the C++ server in the same repository:</p>

<pre><code class="language-sh">$ cd examples/cpp/helloworld
$ make
$ ./greeter_server &amp;
</code></pre>

<h2 id="run-the-client">Run the client</h2>

<h3 id="generate-client-libraries-and-dependencies">Generate client libraries and dependencies</h3>

<p>Have CocoaPods generate and install the client library from our .proto files, as
well as installing several dependencies:</p>

<pre><code class="language-sh">$ cd ../../objective-c/helloworld
$ pod install
</code></pre>

<p>(This might have to compile OpenSSL, which takes around 15 minutes if Cocoapods
doesn&rsquo;t have it yet on your computer&rsquo;s cache.)</p>

<h3 id="run-the-client-app">Run the client app</h3>

<p>Open the Xcode workspace created by CocoaPods:</p>

<pre><code class="language-sh">$ open HelloWorld.xcworkspace
</code></pre>

<p>This will open the app project with Xcode. Run the app in an iOS simulator
by pressing the Run button on the top left corner of Xcode window. You can check
the calling code in <code>main.m</code> and see the results in Xcode&rsquo;s console.</p>

<p>The code sends a <code>HLWHelloRequest</code> containing the string &ldquo;Objective-C&rdquo; to a
local server. The server responds with a <code>HLWHelloResponse</code>, which contains a
string &ldquo;Hello Objective-C&rdquo; that is then output to the console.</p>

<p>Congratulations! You&rsquo;ve just run a client-server application with gRPC.</p>

<h2 id="update-a-grpc-service">Update a gRPC service</h2>

<p>Now let&rsquo;s look at how to update the application with an extra method on the
server for the client to call. Our gRPC service is defined using Protocol
Buffers; you can find out lots more about how to define a service in a <code>.proto</code>
file in Protocol Buffers
<a href="https://developers.google.com/protocol-buffers/">website</a>. For now all you
need to know is that both the server and the client &ldquo;stub&rdquo; have a <code>SayHello</code>
RPC method that takes a <code>HelloRequest</code> parameter from the client and returns a
<code>HelloResponse</code> from the server, and that this method is defined like this:</p>

<pre><code>// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}
</code></pre>

<p>Let&rsquo;s update this so that the <code>Greeter</code> service has two methods. Edit
<code>examples/protos/helloworld.proto</code> and update it with a new <code>SayHelloAgain</code>
method, with the same request and response types:</p>

<pre><code>// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
  // Sends another greeting
  rpc SayHelloAgain (HelloRequest) returns (HelloReply) {}
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}
</code></pre>

<p>(Don&rsquo;t forget to save the file!)</p>

<h2 id="update-the-client-and-server">Update the client and server</h2>

<p>We now have a new gRPC service definition, but we still need to implement and
call the new method in the human-written parts of our example application.</p>

<h3 id="update-the-server">Update the server</h3>

<p>As you remember, gRPC doesn&rsquo;t provide a server API for Objective-C. Instead, we
need to update the C++ sample server. Open
<code>examples/cpp/helloworld/greeter_server.cc</code>. Implement the new method like this:</p>

<pre><code>class GreeterServiceImpl final : public Greeter::Service {
  Status SayHello(ServerContext* context, const HelloRequest* request,
                  HelloReply* reply) override {
    std::string prefix(&quot;Hello &quot;);
    reply-&gt;set_message(prefix + request-&gt;name());
    return Status::OK;
  }
  Status SayHelloAgain(ServerContext* context, const HelloRequest* request,
                  HelloReply* reply) override {
    std::string prefix(&quot;Hello again &quot;);
    reply-&gt;set_message(prefix + request-&gt;name());
    return Status::OK;
  }
};
</code></pre>

<h3 id="update-the-client">Update the client</h3>

<p>Edit <code>examples/objective-c/helloworld/main.m</code> to call the new method like this:</p>

<pre><code>int main(int argc, char * argv[]) {
  @autoreleasepool {
    [GRPCCall useInsecureConnectionsForHost:kHostAddress];
    [GRPCCall setUserAgentPrefix:@&quot;HelloWorld/1.0&quot; forHost:kHostAddress];

    HLWGreeter *client = [[HLWGreeter alloc] initWithHost:kHostAddress];

    HLWHelloRequest *request = [HLWHelloRequest message];
    request.name = @&quot;Objective-C&quot;;

    [client sayHelloWithRequest:request handler:^(HLWHelloReply *response, NSError *error) {
      NSLog(@&quot;%@&quot;, response.message);
    }];
    [client sayHelloAgainWithRequest:request handler:^(HLWHelloReply *response, NSError *error) {
      NSLog(@&quot;%@&quot;, response.message);
    }];

    return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
  }
}
</code></pre>

<h2 id="build-and-run">Build and run</h2>

<p>First terminate the server process already running in the background:</p>

<pre><code class="language-sh">$ pkill greeter_server
</code></pre>

<p>Then in directory <code>examples/cpp/helloworld</code>, build and run the updated server
with the following commands:</p>

<pre><code class="language-sh">$ make
$ ./greeter_server &amp;
</code></pre>

<p>Change directory to <code>examples/objective-c/helloworld</code>, then clean up and
reinstall Pods for the client app with the following commands:</p>

<pre><code class="language-sh">$ rm -Rf Pods
$ rm Podfile.lock
$ rm -Rf HelloWorld.xcworkspace
$ pod install
</code></pre>

<p>This regenerates files in <code>Pods/HelloWorld</code> based on the new proto file we wrote
above. Open the client Xcode project in Xcode:</p>

<pre><code class="language-sh">$ open HelloWorld.xcworkspace
</code></pre>

<p>and run the client app. If you look at the console messages, you should see two RPC calls,
one to SayHello and one to SayHelloAgain.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p><strong>When installing CocoaPods, error prompt <code>activesupport requires Ruby version &gt;= 2.2.2.</code></strong></p>

<p>Install an older version of <code>activesupport</code>, then install CocoaPods:</p>

<pre><code class="language-sh">[sudo] gem install activesupport -v 4.2.6
[sudo] gem install cocoapods
</code></pre>

<p><strong>When installing dependencies with CocoaPods, error prompt <code>Unable to find a specification for !ProtoCompiler-gRPCPlugin</code></strong></p>

<p>Update the local clone of spec repo by running <code>pod repo update</code></p>

<p><strong>Compiler error when compiling <code>objective_c_plugin.cc</code></strong></p>

<p>Removing <code>protobuf</code> package with Homebrew before building gRPC may solve
this problem. We are working on a more elegant fix.</p>

<p><strong>When building HellowWorld, error prompt <code>ld: unknown option: --no-as-needed</code></strong></p>

<p>This problem is due to linker <code>ld</code> in Apple LLVM not supporting the
&ndash;no-as-needed option. We are working on a fix right now and will merge the fix
very soon.</p>

<p><strong>When building grpc, error prompt <code>cannot find install-sh install.sh or shtool</code></strong></p>

<p>Remove the gRPC directory, clone a new one and try again. It is likely that some
auto generated files are corrupt; remove and rebuild may solve the problem.</p>

<p><strong>When building grpc, error prompt <code>Can't exec &quot;aclocal&quot;</code></strong></p>

<p>The package <code>automake</code> is missing. Install <code>automake</code> should solve this problem.</p>

<p><strong>When building grpc, error prompt <code>possibly undefined macro: AC_PROG_LIBTOOL</code></strong></p>

<p>The package <code>libtool</code> is missing. Install <code>libtool</code> should solve this problem.</p>

<p><strong>When building grpc, error prompt <code>cannot find install-sh, install.sh, or shtool</code></strong></p>

<p>Some of the auto generated files are corrupt. Remove the entire gRPC directory,
clone from Github, and build again.</p>

<p><strong>Cannot find <code>protoc</code> when building HelloWorld</strong></p>

<p>Run <code>brew install protobuf</code> to get <code>protoc</code> compiler.</p>

<h2 id="what-s-next">What&rsquo;s next</h2>

<ul>
<li>Read a full explanation of how gRPC works in <a href="../guides/">What is gRPC?</a>
and <a href="../guides/concepts.html">gRPC Concepts</a></li>
<li>Work through a more detailed tutorial in <a href="../tutorials/basic/objective-c.html">gRPC Basics: Objective-C</a></li>
<li>Explore the Objective-C core API in its <a href="http://cocoadocs.org/docsets/gRPC/">reference
documentation</a></li>
</ul>

  </div>

    
    
  </body>
</html>
